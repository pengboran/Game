<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>记事本</title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			.mui-content-padded {
				padding: 10px;
			}
			
			#add {
				position: fixed;
				right: 10px;
				bottom: 10px;
				margin: 3px;
				width: 70px;
				height: 70px;
				line-height: 70px !important;
				display: inline-block;
				text-align: center;
				border: 1px solid #ddd;
				border-radius: 50%;
				background-clip: padding-box;
			}
			
			.mui-content-padded a .mui-icon {
				/*margin-top: 12px;*/
			}
			
			.mui-icon-plusempty {
				font-size: 60px;
			}
			
			.mui-title {
				color: #fff;
				font-size: 1.6rem;
			}
			
			.mui-icon-bars {
				color: #fff;
			}
			
			.mui-off-canvas-left {
				background-color: rgba(0, 0, 0, .5);
			}
			
			.mui-table-view-cell>.mui-badge {
				top: 21.5px;
			}
			
			#body .bg-color {
				color: #fff;
				/*background-color: #00b0f0;*/
			}
		</style>
	</head>

	<body id="body">
		<!-- 侧滑导航根容器 -->
		<div class="mui-off-canvas-wrap mui-draggable mui-slide-in">
			<!-- 菜单容器 -->
			<aside class="mui-off-canvas-left">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll" style="margin-top: 20px;">
						<!-- 菜单具体展示内容 -->
						<ul class="mui-table-view">
							<li class="mui-table-view-cell mui-collapse">
								<a class="mui-navigate-right" href="#">切换主题</a>
								<div class="mui-collapse-content">
									<ul class="mui-table-view" id="zhutiColor">
										<li class="mui-table-view-cell mui-collapse">
											<span style="display: inline-block;width: 16px;height: 16px;background-color: #00b0f0;"></span>#00b0f0
										</li>
										<li class="mui-table-view-cell mui-collapse">
											<span style="display: inline-block;width: 16px;height: 16px;background-color: #00d1b2;"></span>#00d1b2
										</li>
										<li class="mui-table-view-cell mui-collapse">
											<span style="display: inline-block;width: 16px;height: 16px;background-color: #f4b976;"></span>#f4b976
										</li>
										<li class="mui-table-view-cell mui-collapse">
											<span style="display: inline-block;width: 16px;height: 16px;background-color: #f39894;"></span>#f39894
										</li>
										<li class="mui-table-view-cell mui-collapse">
											<span style="display: inline-block;width: 16px;height: 16px;background-color: #26b6be;"></span>#26b6be
										</li>
									</ul>
								</div>
							</li>
							<!--<li class="mui-table-view-cell mui-collapse">
								<a class="mui-navigate-right" href="#">编辑数据</a>
								<div class="mui-collapse-content">
									<p class="mui-text-center">暂无</p>
								</div>
							</li>-->
						</ul>
					</div>
				</div>
			</aside>
			<!-- 主页面容器 -->
			<div class="mui-inner-wrap" id="contentBox">
				<!-- 主页面标题 -->
				<header class="mui-bar mui-bar-nav bg-color">
					<h1 class="mui-title">记事本</h1>
					<a class="mui-icon mui-icon-bars mui-pull-right" id="offCanvasShow"></a>
				</header>
				<!--主页面内容-->
				<div class="mui-content">

					<!--添加信息按钮-->
					<a class="bg-color" id="add">
						<span class="mui-icon mui-icon-plusempty"></span>
					</a>

					<!--折叠面板-->
					<ul class="mui-table-view" style="margin-top: 8px;">
						<li class="mui-table-view-cell mui-collapse">
							<a href="#">未完成</a>
							<span class="mui-badge mui-badge-danger" id="wwcNum">0</span>
							<div class="mui-collapse-content">
								<ul id="nodeBox1" class="mui-table-view" style="margin-top: 0;margin-bottom: 11px;">
									<!--<li class="mui-table-view-cell">
								    	<span style="width: 160px;display: inline-block;">啦啦啦</span>
								    	<span class="mui-btn mui-btn-blue" style="right: 75px;">完成</span>
								    	<span class="mui-btn mui-btn-danger">取消</span>
								    </li>-->
								</ul>
							</div>
						</li>
						<li class="mui-table-view-cell mui-collapse">
							<a href="#">已完成</a>
							<span class="mui-badge mui-badge-primary" id="ywcNum">0</span>
							<div class="mui-collapse-content">
								<ul id="nodeBox2" class="mui-table-view" style="margin-top: 0;margin-bottom: 11px;">

								</ul>
							</div>
						</li>
						<li class="mui-table-view-cell mui-collapse">
							<a href="#">已取消</a>
							<span class="mui-badge mui-badge-yellow" id="yqxNum">0</span>
							<div class="mui-collapse-content">
								<ul id="nodeBox3" class="mui-table-view" style="margin-top: 0;margin-bottom: 11px;">

								</ul>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!--信息录入-->
		<div id="input" class="mui-popover">
			<form class="mui-input-group mui-scroll-wrapper">
				<div style="height: auto;">
					<p class="mui-popup-title" style="padding:10px 0;border-bottom: 1px solid #ddd;">添加代办事项</p>
					<textarea name="c" rows="4" cols="" autofocus="autofocus"></textarea>
				</div>
				<div class="mui-button-row">
					<button id="save" type="button" class="mui-btn mui-btn-primary">保存</button>
					<button id="cancel" type="button" class="mui-btn mui-btn-danger">取消</button>
				</div>
			</form>
		</div>
	</body>
	<script src="js/mui.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		mui.init();
		addData();
		bindChange();
		bindWrap();
		bindAdd();
		bindFinishandcancel();
		bindHuifuanddel();
		bindDelete();


		//绑定侧滑
		function bindWrap() {
			mui("#offCanvasShow")[0].addEventListener("tap", function() {
				mui('.mui-off-canvas-wrap').offCanvas("toggle");
			});
//			mui("#contentBox")[0].addEventListener("tap", function(e) {
//				if(e.target.getAttribute("id") != "offCanvasShow") {
//					mui('.mui-off-canvas-wrap').offCanvas().close();
//				}
//
//			})
		}

		//绑定添加
		function bindAdd() {
			var mask;
			//弹出输入框
			document.getElementById("add").addEventListener("tap", function() {
				mask = mui.createMask(function() {
					document.getElementById("input").style.display = "none";
				}); //callback为用户点击蒙版时自动执行的回调；
				mask.show(); //显示遮罩

				document.getElementById("input").style.display = "block";
				document.getElementById("input").style.zIndex = 1000;
				document.getElementById("input").style.opacity = 1;
				document.getElementById("input").style.top = 180 + "px";
				document.getElementById("input").style.left = (window.innerWidth - 280) / 2 + "px";

				//mask.close();//关闭遮罩
			});
			//添加
			document.getElementById("save").addEventListener("tap", function() {
				var c = document.getElementsByName("c")[0].value;
				if(!c) {
					return;
				}
				var node = JSON.parse(localStorage.getItem("lix_node")) || [];
				var time = formate(new Date());
				console.log(time);
				node.push({
					"id": Math.random(),
					"type": 1,
					"content": c,
					"time": time
				});
				localStorage.setItem("lix_node", JSON.stringify(node));
				document.getElementsByName("c")[0].value = "";
				addData();
				mask.close();
				mui.toast('添加成功!', {
					duration: 2000,
					type: 'div'
				});
			});
			//点击取消
			document.getElementById("cancel").addEventListener("tap", function() {
				mask.close();
			});
		}

		//添加数据到dom
		function addData() {
			//type=1:未完成；2：已完成；3：已取消
			var wwc = 0,
				ywc = 0,
				yqx = 0; //数量
			var html1 = "",
				html2 = "",
				html3 = "";
			var data = JSON.parse(localStorage.getItem("lix_node")) || "";
			if(data){
				for(var i = 0; i < data.length; i++) {
					switch(data[i].type) {
						case 1:
							wwc++;
							html1 += '<li dataId=' + data[i].id + ' class="mui-table-view-cell"><span style="width: 160px;display: inline-block;">' + data[i].content + '<br/>' + data[i].time + '</span><span class="mui-btn mui-btn-blue" style="right: 75px;">完成</span><span class="mui-btn mui-btn-danger">取消</span></li>';
							break;
						case 2:
							ywc++;
							html2 += '<li dataId=' + data[i].id + ' class="mui-table-view-cell"><span style="width: 160px;display: inline-block;">' + data[i].content + '<br/>' + data[i].time + '</span><span class="mui-btn mui-btn-danger">删除</span></li>';
							break;
						case 3:
							yqx++;
							html3 += '<li dataId=' + data[i].id + ' class="mui-table-view-cell"><s style="width: 160px;display: inline-block;">' + data[i].content + '</s><br/>' + data[i].time + '<span class="mui-btn mui-btn-blue" style="right: 75px;">恢复</span><span class="mui-btn mui-btn-danger">删除</span></li>';
							break;
						default:
							break;
					}
				}
			}
			document.getElementById("wwcNum").innerHTML = wwc;
			document.getElementById("ywcNum").innerHTML = ywc;
			document.getElementById("yqxNum").innerHTML = yqx;
			document.getElementById("nodeBox1").innerHTML = html1 || "<p class='mui-text-center'>暂无数据<p>";
			document.getElementById("nodeBox2").innerHTML = html2 || "<p class='mui-text-center'>暂无数据<p>";
			document.getElementById("nodeBox3").innerHTML = html3 || "<p class='mui-text-center'>暂无数据<p>";
		}

		//绑定完成和取消按钮
		function bindFinishandcancel() {
			document.getElementById("nodeBox1").addEventListener("tap", function(e) {
				var id = e.target.parentNode.getAttribute("dataId");
				var data = JSON.parse(localStorage.getItem("lix_node"));
				for(var i = 0; i < data.length; i++) {
					if(data[i].id == id) {
						if(e.target.innerHTML == "完成") {
							data[i].type = 2;

						} else if(e.target.innerHTML == "取消") {
							data[i].type = 3;
						}
						localStorage.setItem("lix_node", JSON.stringify(data));
						addData(); //重新加载dom
						return;
					}
				}
			});
		}

		//绑定恢复
		function bindHuifuanddel() {
			document.getElementById("nodeBox3").addEventListener("tap", function(e) {
				var id = e.target.parentNode.getAttribute("dataId");
				var data = JSON.parse(localStorage.getItem("lix_node"));
				for(var i = 0; i < data.length; i++) {
					if(data[i].id == id) {
						if(e.target.innerHTML == "恢复") {
							data[i].type = 1;

						} else if(e.target.innerHTML == "删除") {
							data.splice(i, 1);
						}
						localStorage.setItem("lix_node", JSON.stringify(data));
						addData(); //重新加载dom
						return;
					}
				}
			});
		}
		//绑定删除
		function bindDelete() {
			document.getElementById("nodeBox2").addEventListener("tap", function(e) {
				var id = e.target.parentNode.getAttribute("dataId");
				var data = JSON.parse(localStorage.getItem("lix_node"));
				for(var i = 0; i < data.length; i++) {
					if(data[i].id == id) {
						if(e.target.innerHTML == "删除") {
							data.splice(i, 1);
						}
						localStorage.setItem("lix_node", JSON.stringify(data));
						addData(); //重新加载dom
						return;
					}
				}
			});
		}

		//绑定切换主题
		function bindChange() {
			var c = document.getElementsByClassName("bg-color");
			var bgColor = localStorage.getItem("bgColor") || "#00b0f0";
			for(var i = 0; i < c.length; i++) {
				c[i].style.backgroundColor = bgColor;
			}
			document.getElementById("zhutiColor").addEventListener("tap", function(e) {
				if(e.target.nodeName == "LI") {
					var c = document.getElementsByClassName("bg-color");
					for(var i = 0; i < c.length; i++) {
						c[i].style.backgroundColor = e.target.innerText;
						localStorage.setItem("bgColor", e.target.innerText);
					}
				}
			});
		}

		//日期格式化
		function formate(t) {
			var time = new Date(t);
			var y = time.getFullYear();
			var m = time.getMonth() + 1;
			m < 10 ? "0" + m : m;
			var d = time.getDate();
			d < 10 ? "0" + d : d;
			return y + "-" + m + "-" + d;
		}
	</script>

</html>